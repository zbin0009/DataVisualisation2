{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "description": "Scatter plot of distance vs patronage for Metro stations",
  "title": {"text": "Metro â€” Distance vs Patronage", "anchor": "start", "color": "#1e3a8a", "fontSize": 16, "fontWeight": 700},
  "data": { "url": "combined.csv", "format": { "type": "csv" } },
  "params": [ {"name": "MinEntries", "value": 0} ],
  "transform": [
    {"calculate": "sqrt(pow(toNumber(datum.latitude)-(-37.8136),2)+pow(toNumber(datum.longitude)-(144.9631),2))*111", "as": "distance_km"},
    {"calculate": "toNumber(datum.entries)", "as": "entries_q"},
    {"filter": "datum.entries_q >= MinEntries"},
    {"filter": "datum.type == 'Metro'"}
  ],
  "width": 520,
  "height": 380,
  "layer": [
    {
      "mark": { "type": "circle", "opacity": 0.7, "filled": true },
      "encoding": {
        "x": {"field": "distance_km", "type": "quantitative", "title": "Distance from Melbourne CBD (km)", "axis": {"grid": true, "gridColor": "#e2e8f0", "tickCount": 8}, "scale": {"domain": [0, 160]}},
        "y": {"field": "entries_q", "type": "quantitative", "title": "Annual Patronage", "axis": {"grid": true, "gridColor": "#e2e8f0", "tickCount": 6}, "scale": {"domain": [0, 20000000]}},
        "color": {"value": "#2563eb"},
        "tooltip": [
          {"field": "name", "title": "Station"},
          {"field": "distance_km", "title": "Distance (km)", "format": ".1f"},
          {"field": "entries_q", "title": "Annual Patronage", "format": ","}
        ]
      }
    },
    {
      "transform": [ {"regression": "entries_q", "on": "distance_km"} ],
      "mark": { "type": "line", "strokeWidth": 2, "opacity": 0.85, "color": "#2563eb" },
      "encoding": { "x": {"field": "distance_km", "type": "quantitative"}, "y": {"field": "entries_q", "type": "quantitative"} }
    }
  ],
  "config": { "view": { "stroke": "transparent" } }
}


