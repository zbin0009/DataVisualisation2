{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "description": "Top 10 Metro Stations (Excluding Southern Cross)",
  "data": {
    "url": "metro.csv"
  },
  "transform": [
    {
      "filter": "!test(/southern\\s*cross/i, datum.station_name)"
    },
    {
      "calculate": "toNumber(datum.annual_entries)",
      "as": "annual"
    },
    {
      "window": [{"op": "rank", "as": "rank"}],
      "sort": [{"field": "annual", "order": "descending"}]
    },
    {
      "filter": "datum.rank <= 10"
    }
  ],
  "mark": {"type": "bar", "cornerRadiusEnd": 4},
  "encoding": {
    "y": {
      "field": "station_name",
      "type": "ordinal",
      "sort": "-x",
      "title": "Metro Station",
      "axis": {"labelLimit": 200}
    },
    "x": {
      "field": "annual",
      "type": "quantitative",
      "title": "Annual Entries",
      "axis": {"grid": true, "tickCount": 6, "format": "s"}
    },
    "color": {
      "field": "annual",
      "type": "quantitative",
      "scale": {"scheme": "blues"},
      "title": "Patronage Intensity"
    },
    "tooltip": [
      {"field": "station_name", "title": "Station"},
      {"field": "annual", "title": "Annual Entries", "format": ","}
    ]
  },
  "config": {"view": {"stroke": "transparent"}},
  "width": "container",
  "height": 400
}
